      - name: Test SSH Connection to Gitee
        run: |
          mkdir -p ~/.ssh
          # 1. 将私钥写入文件并检查其格式
          echo "${{ secrets.GITEE_PRIVATE_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          
          echo "=== 检查私钥文件头尾 ==="
          head -n 2 ~/.ssh/id_rsa
          echo "..."
          tail -n 2 ~/.ssh/id_rsa
          echo ""
          
          echo "=== 计算私钥指纹 (对应公钥指纹) ==="
          # 这个命令会输出一个类似 SHA256:xxxxxxxx 的指纹
          ssh-keygen -lf ~/.ssh/id_rsa
          echo ""
          
          # 2. 进行详细的SSH连接测试
          ssh -T -v -o StrictHostKeyChecking=no git@gitee.com 2>&1 | grep -A5 -B5 "Authentication succeeded\|Permission denied"

name: 'Sync to Gitee'
on: # 触发条件：可以按需选择或组合
  push: # 当向 main 分支推送代码时触发
    branches:
      - main
  workflow_dispatch: # 允许在GitHub Actions页面手动触发此工作流

jobs:
  mirror:
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout GitHub Repo'
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # 获取所有历史，这对镜像很重要

      - name: 'Mirror to Gitee'
        uses: wearerequired/git-mirror-action@v1
        env:
          # 关键：从Secrets中读取私钥，该Action会自动处理文件创建和权限设置
          SSH_PRIVATE_KEY: ${{ secrets.GITEE_PRIVATE_KEY }}
        with:
          # 配置源仓库（你的GitHub仓库）
          source-repo: 'git@github.com:mgskkk/wj.git'
          # 配置目标仓库（你的Gitee仓库）【必须修改】
          destination-repo: 'git@gitee.com:mgskkk/wj.git'
          # 注意：请将上面的“你的Gitee用户名/你的仓库名”替换为实际值
